{
  "name": "gold-standard-worker",
  "main": "worker/index.ts", // API Worker entrypoint
  "compatibility_date": "2024-07-25",
  "compatibility_flags": ["nodejs_compat"],

  // Vite-plugin-cloudflare uses this during `vite build`
  "build": {
    "command": "bun run build",
    "watch_dir": "src" // Watch the SPA for changes
  },

  // Serve the Vite SPA (built to './dist') as the static site
  "site": {
    "bucket": "./dist"
  },

  // Bindings for the API Worker
  "ai": {
    "binding": "AI" // Workers AI
  },

  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "gold_standard_db",
      "database_id": "YOUR_D1_DATABASE_ID_HERE", // Must be created manually first
      "migrations_dir": "./migrations"
    }
  ],

  "r2_buckets": [
    {
      "binding": "AUDIO_BUCKET",
      "bucket_name": "interview-audio",
      "preview_bucket_name": "interview-audio-preview"
    }
  ],

  "durable_objects": {
    "bindings": [
      {
        "name": "WS_HANDLER",
        "class_name": "WebSocketServer"
      },
      {
        "name": "MCP_AGENT",
        "class_name": "CloudflareMcpAgent"
      },
      { 
        "name": "ORCHESTRATOR", 
        "class_name": "OrchestratorDO" 
      }
    ]
  },

  "migrations": [
    {
      "tag": "v1",
      "new_sqlite_classes": [
        "WebSocketServer",
        "CloudflareMcpAgent",
        "OrchestratorDO"
      ]
    }
  ],

  // Environment variables (non-secret)
  // For secrets, use `wrangler secret put <NAME>` or set in Cloudflare Dashboard
  "vars": {
    // MCP Authentication Settings (optional)
    "MCP_AUTH_ENABLED": "false"
  }

  // --- SECRETS (set via wrangler secret put or .dev.vars for local dev) ---
  // OPENAI_API_KEY - OpenAI API key for AI SDK
  // GEMINI_API_KEY - Google Gemini API key (alternative)
  // MCP_API_KEYS - Comma-separated API keys for MCP authentication
  // CLOUDFLARE_ACCESS_TEAM_DOMAIN - Cloudflare Access team domain
  // CLOUDFLARE_ACCESS_AUDIENCE - Cloudflare Access audience tag
}
